# ä¼ä¸šå¾®ä¿¡ OpenClaw é›†æˆæ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä¸º OpenClaw æ·»åŠ ä¼ä¸šå¾®ä¿¡ï¼ˆWeComï¼‰é¢‘é“æ”¯æŒï¼Œå®ç°é€šè¿‡ä¼ä¸šå¾®ä¿¡ä¸ AI åŠ©æ‰‹å¯¹è¯çš„åŠŸèƒ½ã€‚

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
ç”¨æˆ·å‘æ¶ˆæ¯ â†’ ä¼ä¸šå¾®ä¿¡æœåŠ¡å™¨ â†’ äº‘æœåŠ¡å™¨(ä¸­è½¬) â†’ WebSocket â†’ æœ¬åœ° OpenClaw
                                                              â†“
                                                          AI å¤„ç† (æ™ºè°±)
                                                              â†“
                            æœ¬åœ° OpenClaw â†’ ä¼ä¸šå¾®ä¿¡ API â†’ å›å¤ç”¨æˆ·
```

### è®¾è®¡ç†å¿µ

å‚è€ƒé£ä¹¦æ’ä»¶çš„æ¶æ„ï¼š
- **é£ä¹¦**ï¼šä½¿ç”¨ SDK å»ºç«‹ WebSocket é•¿è¿æ¥ï¼Œæœ¬åœ°ä¸»åŠ¨è¿æ¥é£ä¹¦æœåŠ¡å™¨
- **ä¼ä¸šå¾®ä¿¡**ï¼šæ²¡æœ‰ WebSocket SDKï¼Œåªæ”¯æŒ HTTP å›è°ƒ

å› æ­¤è®¾è®¡äº†"ä¸­è½¬æœåŠ¡å™¨"æ–¹æ¡ˆï¼š
1. äº‘æœåŠ¡å™¨æ¥æ”¶ä¼ä¸šå¾®ä¿¡çš„ HTTP å›è°ƒ
2. äº‘æœåŠ¡å™¨é€šè¿‡ WebSocket æ¨é€æ¶ˆæ¯ç»™æœ¬åœ° OpenClaw
3. æœ¬åœ° OpenClaw å¤„ç†æ¶ˆæ¯ï¼Œè°ƒç”¨ AI
4. æœ¬åœ° OpenClaw ç›´æ¥è°ƒç”¨ä¼ä¸šå¾®ä¿¡ API å‘é€å›å¤

è¿™æ ·æœ¬åœ° OpenClaw æ’ä»¶çš„è¡Œä¸ºä¸é£ä¹¦æ’ä»¶ä¿æŒä¸€è‡´ã€‚

---

## æ–‡ä»¶ç»“æ„

### 1. äº‘æœåŠ¡å™¨ä¸­è½¬æœåŠ¡ (`wecom-callback-server/`)

```
wecom-callback-server/
â”œâ”€â”€ package.json      # ä¾èµ–ï¼šws, xml2js
â””â”€â”€ server.js         # ä¸­è½¬æœåŠ¡å™¨ä»£ç 
```

**åŠŸèƒ½**ï¼š
- HTTP ç«¯å£ 3003ï¼šæ¥æ”¶ä¼ä¸šå¾®ä¿¡å›è°ƒ
- WebSocket ç«¯å£ 3004ï¼šæ¨é€æ¶ˆæ¯ç»™æœ¬åœ° OpenClaw
- æ¶ˆæ¯è§£å¯†å’Œç­¾åéªŒè¯
- å¿ƒè·³ä¿æ´»

### 2. OpenClaw ä¼ä¸šå¾®ä¿¡æ’ä»¶ (`wecom-plugin/`)

```
wecom-plugin/
â”œâ”€â”€ package.json              # ä¾èµ–ï¼šws
â”œâ”€â”€ clawdbot.plugin.json      # æ’ä»¶é…ç½®
â”œâ”€â”€ index.ts                  # å…¥å£æ–‡ä»¶
â”œâ”€â”€ README.md                 # æ’ä»¶æ–‡æ¡£
â””â”€â”€ src/
    â”œâ”€â”€ channel.ts            # é¢‘é“å®šä¹‰ï¼ˆé…ç½® schemaã€å¯åŠ¨é€»è¾‘ï¼‰
    â”œâ”€â”€ runtime.ts            # PluginRuntime ç®¡ç†
    â”œâ”€â”€ send.ts               # å‘é€æ¶ˆæ¯åˆ°ä¼ä¸šå¾®ä¿¡
    â”œâ”€â”€ sync-service.ts       # æ´»è·ƒèŠå¤©çŠ¶æ€ç®¡ç†
    â”œâ”€â”€ wecom-ws.ts           # WebSocket è¿æ¥ä¸­è½¬æœåŠ¡å™¨
    â”œâ”€â”€ wecom-callback.ts     # (æ—§) HTTP å›è°ƒæœåŠ¡å™¨ï¼ˆå·²å¼ƒç”¨ï¼‰
    â”œâ”€â”€ wecom-crypto.ts       # (æ—§) åŠ è§£å¯†ï¼ˆå·²å¼ƒç”¨ï¼Œé€»è¾‘ç§»åˆ°ä¸­è½¬æœåŠ¡å™¨ï¼‰
    â”œâ”€â”€ doc-service.ts        # ä¼ä¸šå¾®ä¿¡æ–‡æ¡£/è¡¨æ ¼/å®¢æˆ· API
    â””â”€â”€ wecom-tools.ts        # AI å·¥å…·å®šä¹‰
```

### 3. éƒ¨ç½²è„šæœ¬ (`mcp-ssh/`)

å„ç§ç”¨äºéƒ¨ç½²å’Œè°ƒè¯•çš„ Node.js è„šæœ¬ï¼ˆå¯é€‰ï¼Œéæ ¸å¿ƒä»£ç ï¼‰ã€‚

---

## äº‘æœåŠ¡å™¨éƒ¨ç½²çŠ¶æ€

### æœåŠ¡å™¨ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| IP | 82.156.174.32 |
| ç”¨æˆ·å | ubuntu |
| å¯†ç  | Lgx780504 |
| ç³»ç»Ÿ | Ubuntu 24.04 LTS |

### å·²éƒ¨ç½²æœåŠ¡

| æœåŠ¡ | ç«¯å£ | çŠ¶æ€ |
|------|------|------|
| HTTP å›è°ƒ | 3003 | âœ… è¿è¡Œä¸­ |
| WebSocket | 3004 | âœ… è¿è¡Œä¸­ |
| Nginx HTTPS | 443 | âœ… è¿è¡Œä¸­ |

### Nginx é…ç½®

åŸŸåï¼š`openclawwx.metaseek.cc`

| è·¯å¾„ | è½¬å‘åˆ° | ç”¨é€” |
|------|--------|------|
| `/wecom/` | http://127.0.0.1:3003/ | ä¼ä¸šå¾®ä¿¡å›è°ƒ |
| `/ws` | ws://127.0.0.1:3004 | OpenClaw WebSocket è¿æ¥ |
| `/health` | http://127.0.0.1:3003/health | å¥åº·æ£€æŸ¥ |
| `/status` | http://127.0.0.1:3003/status | çŠ¶æ€é¡µé¢ |

### SSL è¯ä¹¦

- æä¾›å•†ï¼šLet's Encrypt
- åŸŸåï¼šopenclawwx.metaseek.cc
- è¯ä¹¦è·¯å¾„ï¼š`/etc/letsencrypt/live/openclawwx.metaseek.cc/`

---

## ä¼ä¸šå¾®ä¿¡é…ç½®

### ä¼ä¸šä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| ä¼ä¸š ID | wwd942eecef040d78e |
| åº”ç”¨ AgentId | 1000004 |
| åº”ç”¨ Secret | XYqbQvhgIj5E0Q59ZqRsSu9cmJpoHFEUDlkVr9h-iX4 |

### å›è°ƒé…ç½®

| é¡¹ç›® | å€¼ |
|------|-----|
| å›è°ƒ URL | https://openclawwx.metaseek.cc/wecom/callback |
| Token | pKr0mMp9Z6Op |
| EncodingAESKey | 3hPX7dwAYg26ClhFiaGHeIzgXUr8HFh941Yul8yRsIO |

**çŠ¶æ€**ï¼šâœ… å·²åœ¨ä¼ä¸šå¾®ä¿¡åå°éªŒè¯é€šè¿‡

---

## OpenClaw é…ç½®ç¤ºä¾‹

åœ¨ OpenClaw é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```json
{
  "channels": {
    "wecom": {
      "enabled": true,
      "corpId": "wwd942eecef040d78e",
      "corpSecret": "XYqbQvhgIj5E0Q59ZqRsSu9cmJpoHFEUDlkVr9h-iX4",
      "agentId": "1000004",
      "relayServer": "wss://openclawwx.metaseek.cc/ws",
      "dmPolicy": "open"
    }
  }
}
```

### é…ç½®è¯´æ˜

| å­—æ®µ | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| corpId | âœ… | ä¼ä¸š ID |
| corpSecret | âœ… | åº”ç”¨ Secret |
| agentId | âœ… | åº”ç”¨ AgentId |
| relayServer | âœ… | ä¸­è½¬æœåŠ¡å™¨ WebSocket åœ°å€ |
| dmPolicy | âŒ | ç§èŠç­–ç•¥ï¼šopen/pairing/allowlist |
| allowFrom | âŒ | å…è®¸çš„ç”¨æˆ· ID åˆ—è¡¨ |

---

## å·²å®Œæˆçš„å·¥ä½œ

### âœ… äº‘æœåŠ¡å™¨é…ç½®
- [x] è¿æ¥æœåŠ¡å™¨ (82.156.174.32)
- [x] ç”³è¯· SSL è¯ä¹¦ (openclawwx.metaseek.cc)
- [x] é…ç½® Nginx åå‘ä»£ç†
- [x] éƒ¨ç½²ä¸­è½¬æœåŠ¡ (HTTP + WebSocket)
- [x] ä¼ä¸šå¾®ä¿¡å›è°ƒéªŒè¯é€šè¿‡

### âœ… æ’ä»¶å¼€å‘
- [x] é¢‘é“å®šä¹‰ (channel.ts)
- [x] WebSocket è¿æ¥é€»è¾‘ (wecom-ws.ts)
- [x] æ¶ˆæ¯å‘é€ (send.ts)
- [x] AI å·¥å…·å®šä¹‰ (wecom-tools.ts)
- [x] æ–‡æ¡£/è¡¨æ ¼/å®¢æˆ· API å°è£… (doc-service.ts)

### âœ… æµ‹è¯•éªŒè¯
- [x] ä¼ä¸šå¾®ä¿¡å‘é€æ¶ˆæ¯ â†’ äº‘æœåŠ¡å™¨æ¥æ”¶æˆåŠŸ
- [x] æ¶ˆæ¯è§£å¯†æ­£å¸¸
- [x] å¥åº·æ£€æŸ¥ API æ­£å¸¸

---

## å¾…å®Œæˆçš„å·¥ä½œ

### ğŸ”² æœ¬åœ°é›†æˆ
- [ ] åœ¨æœ¬åœ° OpenClaw å®‰è£… wecom-plugin
- [ ] é…ç½® OpenClaw å¯ç”¨ä¼ä¸šå¾®ä¿¡é¢‘é“
- [ ] æµ‹è¯•æœ¬åœ° WebSocket è¿æ¥ä¸­è½¬æœåŠ¡å™¨
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•ï¼šå‘æ¶ˆæ¯ â†’ AI å›å¤

### ğŸ”² åŠŸèƒ½å®Œå–„
- [ ] æµ‹è¯• AI å·¥å…·ï¼ˆè¯»å–è¡¨æ ¼ã€æ–‡æ¡£ã€å®¢æˆ·ä¿¡æ¯ï¼‰
- [ ] å®Œå–„é”™è¯¯å¤„ç†å’Œé‡è¿é€»è¾‘
- [ ] æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±
- [ ] æ”¯æŒå›¾ç‰‡/æ–‡ä»¶æ¶ˆæ¯

### ğŸ”² å¯é€‰ä¼˜åŒ–
- [ ] æ¸…ç† mcp-ssh ç›®å½•ä¸‹çš„ä¸´æ—¶è„šæœ¬
- [ ] æ·»åŠ æœåŠ¡è‡ªåŠ¨é‡å¯ (systemd)
- [ ] æ·»åŠ æ—¥å¿—è½®è½¬

---

## å¦‚ä½•ç»§ç»­å¼€å‘

### 1. å®‰è£…æ’ä»¶ä¾èµ–

```bash
cd wecom-plugin
npm install
```

### 2. å°†æ’ä»¶æ³¨å†Œåˆ° OpenClaw

å‚è€ƒé£ä¹¦æ’ä»¶çš„æ³¨å†Œæ–¹å¼ï¼Œå°† `wecom-plugin` æ·»åŠ åˆ° OpenClaw çš„æ’ä»¶åˆ—è¡¨ä¸­ã€‚

### 3. é…ç½®å¹¶å¯åŠ¨ OpenClaw

æ·»åŠ ä¼ä¸šå¾®ä¿¡é…ç½®åï¼Œå¯åŠ¨ OpenClaw Gatewayã€‚

### 4. éªŒè¯è¿æ¥

å¯åŠ¨åæŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
[wecom] æ­£åœ¨è¿æ¥ä¸­è½¬æœåŠ¡å™¨: wss://openclawwx.metaseek.cc/ws
[wecom] å·²è¿æ¥åˆ°ä¸­è½¬æœåŠ¡å™¨
```

åŒæ—¶äº‘æœåŠ¡å™¨çŠ¶æ€é¡µé¢ (https://openclawwx.metaseek.cc/status) åº”è¯¥æ˜¾ç¤ºï¼š
```
å·²è¿æ¥å®¢æˆ·ç«¯: 1
```

### 5. æµ‹è¯•å¯¹è¯

åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ‰¾åˆ°åº”ç”¨ï¼Œå‘é€æ¶ˆæ¯ï¼Œåº”è¯¥æ”¶åˆ° AI å›å¤ã€‚

---

## è°ƒè¯•å‘½ä»¤

### æ£€æŸ¥äº‘æœåŠ¡å™¨çŠ¶æ€

```bash
# SSH è¿æ¥
ssh ubuntu@82.156.174.32

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
ss -tlnp | grep -E "3003|3004"

# æŸ¥çœ‹æ—¥å¿—
cat ~/wecom-callback/wecom.log

# é‡å¯æœåŠ¡
cd ~/wecom-callback
pkill -f "node server.js"
nohup node server.js > wecom.log 2>&1 &
```

### å¥åº·æ£€æŸ¥

```bash
curl https://openclawwx.metaseek.cc/health
# åº”è¿”å›: {"status":"ok","clients":0}
```

---

## å‚è€ƒæ–‡ä»¶

- é£ä¹¦æ’ä»¶å®ç°ï¼š`feishu-guide/feishu-plugin/`
- ä¼ä¸šå¾®ä¿¡ API æ–‡æ¡£ï¼šhttps://developer.work.weixin.qq.com/document/
- OpenClaw æ’ä»¶ SDK æ–‡æ¡£ï¼šå‚è€ƒ `openclaw/plugin-sdk`

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. äº‘æœåŠ¡å™¨æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. ä¼ä¸šå¾®ä¿¡åå°å›è°ƒé…ç½®æ˜¯å¦æ­£ç¡®
3. OpenClaw é…ç½®ä¸­çš„ relayServer åœ°å€æ˜¯å¦æ­£ç¡®
4. é˜²ç«å¢™æ˜¯å¦å…è®¸ WebSocket è¿æ¥
